(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{"62ce":function(e,o,r){"use strict";r.r(o);var a=function(){var e=this,o=e.$createElement,r=e._self._c||o;return r("div",[r("bodyTabs",{attrs:{titulo:"Cadastro de Usuários"}},[r("template",{slot:"tabHeader"},[r("q-tab",{attrs:{name:"tab-1",icon:"folder_shared",label:"Cadastro"}})],1),r("template",{slot:"tabPanel"},[r("q-tab-panel",{attrs:{name:"tab-1"}},[r("form",{on:{submit:function(o){return o.preventDefault(),e.salvarAlterar(o)}}},[r("div",{staticClass:"row"},[r("div",{staticClass:"col-md-6"},[r("barra-de-botoes",{attrs:{id:e.usuario.usuario,possoGravar:e.possoGravarUsuario,possoAlterar:e.possoAlterarUsuario,possoExcluir:e.possoExcluirUsuario},on:{reset:e.reset,excluir:e.excluir,submit:e.salvarAlterar}})],1),r("div",{staticClass:"col-md-6 text-right"},[e.possoAlterarUsuario?r("q-btn",{attrs:{small:"",type:"button",icon:"lock_open"},on:{click:function(o){e.ModalTrocaSenha=!0}}},[e._v("Alterar Senha")]):e._e()],1)]),r("div",{staticClass:"row"},[r("div",{staticClass:"col-md-4"},[r("q-input",{staticClass:"form-input",attrs:{hint:"Obrigatório",error:e.$v.usuario.nome.$error,"error-message":e.errorNome,label:"Nome",autocomplete:"off",type:"text",required:"",name:"name"},on:{blur:function(o){return e.$v.usuario.nome.$touch()}},model:{value:e.usuario.nome,callback:function(o){e.$set(e.usuario,"nome",o)},expression:"usuario.nome"}})],1),r("div",{staticClass:"col-md-4"},[r("q-input",{staticClass:"form-input",attrs:{hint:"Obrigatório",error:e.$v.usuario.login.$error,"error-message":e.errorLogin,label:"Login",autocomplete:"off",type:"text",required:"",name:"username"},on:{input:function(o){return e.$v.usuario.login.$touch()}},model:{value:e.usuario.login,callback:function(o){e.$set(e.usuario,"login",o)},expression:"usuario.login"}})],1),r("div",{staticClass:"col-md-4"},[r("form-select",{attrs:{classe:"form-input",label:"Grupos de Usuário",hint:"Obrigatório",options:e.optionsGrupoUsuario,required:""},model:{value:e.usuario.grupoUsuario,callback:function(o){e.$set(e.usuario,"grupoUsuario",o)},expression:"usuario.grupoUsuario"}})],1)])])])],1)],2),r("lista-de-registros"),r("q-dialog",{attrs:{"content-css":{minWidth:"50vw",minHeight:"50vh"}},on:{close:e.cancelarModal,hide:e.resetaModalSenha},model:{value:e.ModalTrocaSenha,callback:function(o){e.ModalTrocaSenha=o},expression:"ModalTrocaSenha"}},[r("q-card",[r("q-card-section",{staticClass:"row items-center"},[r("div",{staticClass:"text-h6"},[e._v("Alterar Senha")]),r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""},on:{click:e.cancelarModal}})],1),r("q-card-section",[r("div",{staticClass:"layout-padding"},[e._v("\n          Digite e confirme a nova senha\n          "),r("form",{attrs:{id:"alterarSenha"},on:{submit:function(o){return o.preventDefault(),e.alterarSenhaOutroUsuario(o)}}},[r("q-input",{attrs:{hint:"Obrigatório",error:e.$v.modal.senhaNova.$error,"error-message":"Digite a nova senha, minimo de 5 caracteres",type:"password","stack-label":"",label:"Nova senha"},on:{blur:function(o){return e.$v.modal.senhaNova.$touch()}},model:{value:e.modal.senhaNova,callback:function(o){e.$set(e.modal,"senhaNova",o)},expression:"modal.senhaNova"}}),r("q-input",{attrs:{hint:"Obrigatório",error:e.$v.modal.confirmaSenha.$error,"error-message":"As senhas novas devem ser iguais",type:"password","stack-label":"",label:"Repita a nova senha"},on:{blur:function(o){return e.$v.modal.confirmaSenha.$touch()}},model:{value:e.modal.confirmaSenha,callback:function(o){e.$set(e.modal,"confirmaSenha",o)},expression:"modal.confirmaSenha"}})],1)]),r("br"),r("div",{staticClass:"row justify-center botoes"},[r("q-btn",{attrs:{color:"primary",type:"submit",form:"alterarSenha"}},[e._v("Alterar")]),r("q-btn",{staticClass:"text-black",attrs:{type:"reset",color:"light",form:"alterarSenha"},on:{click:e.cancelarModal}},[e._v("Cancelar")])],1)])],1)],1)],1)},s=[],t=(r("8e6e"),r("8a81"),r("ac6a"),r("cadf"),r("06db"),r("456d"),r("9523")),i=r.n(t),n=(r("f751"),r("bbff")),u=r("d335"),l=r("2f62"),c=function(){var e=this,o=e.$createElement,r=e._self._c||o;return r("lista-de-registros",{ref:"listaDeRegistros",attrs:{labelHeader:"Usuários"},on:{atualizaLista:e.atualizaLista}},[r("template",{slot:"qItem"},e._l(e.getRegistros,(function(o,a){return r("q-item",{key:a,staticClass:"item-lista",class:a%2?"bg-blue-grey-1":"bg-blue-grey-2",attrs:{multiline:"",item:"",to:{name:"alterarUsuario",params:{id:o.usuario}},exact:""}},[r("q-item-label",[r("q-item-section",{attrs:{header:""}},[e._v(" "+e._s(o.login+" - "+o.nome))]),o.email?r("q-item-section",{attrs:{caption:""}},[e._v(e._s(o.email))]):e._e()],1)],1)})),1)],2)},m=[],d=r("dbcf"),h=r("0da6"),p=r("ca9a");function g(e,o){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);o&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function f(e){for(var o=1;o<arguments.length;o++){var r=null!=arguments[o]?arguments[o]:{};o%2?g(Object(r),!0).forEach((function(o){i()(e,o,r[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))}))}return e}var v={name:"ListaDeUsuarios",components:{ListaDeRegistros:h["a"]},data:function(){return{}},computed:f({},Object(l["b"])({getRegistros:"listaDeRegistros/getRegistros"})),methods:{atualizaLista:function(e){d["a"].atualizaLista({service:p["a"],semRegistros:[{login:"Sem registros encontrados",nome:""}],self:this,done:e})}}},b=v,$=r("2877"),O=Object($["a"])(b,c,m,!1,null,null,null),q=O.exports,y=r("b5ae"),U=r("970b"),w=r.n(U),S=function e(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};w()(this,e),this.usuario=o.usuario||"",this.nome=o.nome||"",this.login=o.login||"",this.grupoUsuario=o.grupoUsuario||"",this.usuarioCriador=o.usuarioCriador||""},C=r("b673"),j=r("de64"),x=r("99b66"),P=r("77cc");function A(e,o){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);o&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),r.push.apply(r,a)}return r}function k(e){for(var o=1;o<arguments.length;o++){var r=null!=arguments[o]?arguments[o]:{};o%2?A(Object(r),!0).forEach((function(o){i()(e,o,r[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o))}))}return e}var D={name:"Cadastro-de-Usuarios",components:{BodyTabs:n["a"],ListaDeRegistros:q,BarraDeBotoes:u["a"],formSelect:P["a"]},data:function(){return{modal:{senhaNova:"",confirmaSenha:""},timer:"",ModalTrocaSenha:!1,selected:[],usuario:new S,grupoUsuario:"",optionsGrupoUsuario:[],errorNome:"Preencha nome do usuário",errorLogin:"Preencha o login do usuário",possoAlterarUsuario:!1,possoExcluirUsuario:!1}},validations:{usuario:{login:{required:y["required"],isUnique:function(e){var o=this,r=e;if(""===r)return this.errorLogin="Preencha o login do usuário",!0;var a="gravar",s="";this.usuario.usuario&&(a="alterar",s=this.usuario.usuario);var t=Object(C["a"])("usuarios","login",a,s,"usuario",r).then((function(e){if(200===e.status)return!0===e.data.resposta||(o.errorLogin="Este login já está em uso, escolha um diferente",!1)}));return t}},nome:{required:y["required"]},grupoUsuario:{required:y["required"]}},modal:{senhaNova:{required:y["required"],minLength:Object(y["minLength"])(5)},confirmaSenha:{sameAsPassword:Object(y["sameAs"])("senhaNova")}}},methods:{resetaModalSenha:function(){this.$v.modal.$reset(),this.modal.senhaNova="",this.modal.confirmaSenha=""},alterarSenhaOutroUsuario:function(){var e=this;this.$v.modal.$touch(),this.$v.modal.$error?this.$q.dialog({title:"Atenção",message:"Alguns campos precisam ser corrigidos."}).then((function(){})).catch((function(){})):(this.$q.loading.show({message:"Processando sua requisição",messageColor:"white",spinnerSize:250,spinnerColor:"white"}),p["a"].alteraSenhaOutroUsuario(this.usuario.usuario,this.modal.senhaNova,this.usuario.usuarioCriador).then((function(o){e.$q.loading.hide(),e.ModalTrocaSenha=!1,e.$q.notify({type:"positive",message:"Senha Alterada com sucesso.",timeout:5e3})})))},cancelarModal:function(){this.modal.senhaNova="",this.modal.confirmaSenha="",this.$v.modal.$reset()},reset:function(){this.$v.usuario.$reset(),this.usuario=new S,this.possoAlterarUsuario=!1,this.possoExcluirUsuario=!1,this.$router.push({name:"usuario"})},carrega:function(e){var o=this;console.log("vou carregar o usuario"),this.$q.loading.show({message:"Localizando o registro",messageColor:"white",spinnerSize:250,spinnerColor:"white"}),p["a"].seleciona(e).then((function(e){console.log(e),o.$q.loading.hide(),console.log("peguei o usuario com sucesso"),o.usuario=Object.assign({},o.usuario,e.data),o.confereAlterarExcluir()}))},salvarAlterar:function(){var e=this;this.$q.loading.show({message:"Processando sua requisição",messageColor:"white",spinnerSize:250,spinnerColor:"white"}),clearTimeout(this.timer),this.timer=setTimeout((function(){if(e.$v.usuario.$touch(),e.$v.usuario.$error)return e.$q.loading.hide(),void e.$q.dialog({title:"Atenção",message:"Alguns campos precisam ser corrigidos."}).then((function(){})).catch((function(){}));e.usuario.usuario&&e.possoAlterarUsuario?(console.log("estou alterando o form"),p["a"].altera(e.usuario).then((function(o){console.log("usuario alterado com sucesso"),e.$root.$emit("alteraUnicoRegistro",e.usuario),e.$q.notify({type:"positive",message:"Usuário alterado com sucesso.",timeout:5e3}),e.$q.loading.hide()}))):!e.usuario.usuario&&e.possoGravarUsuario?p["a"].grava(e.usuario).then((function(o){console.log("usuario criado com sucesso"),e.usuario.usuario=o.data.usuario.usuario,e.usuario.usuarioCriador=o.data.usuario.usuarioCriador,e.$router.push("/usuarios/usuario/"+o.data.usuario.usuario),e.$q.notify({type:"positive",message:"Usuário criado com sucesso.",timeout:5e3}),e.$q.notify({type:"warning",message:"Foi criado uma senha automática: 12345. Será necessário a troca da senha no primeiro login deste usuário.",timeout:1e4}),e.$root.$emit("adicionaRegistroNaLista",e.usuario),e.confereAlterarExcluir()})):x["a"].semPermissao()}),2e3)},excluir:function(){var e=this;this.possoExcluirUsuario?this.$q.dialog({title:"Tem certeza?",message:"Ao confirmar esta operação, não poderá desfazer.",ok:"Sim, excluir",cancel:"Cancelar"}).then((function(){e.$q.loading.show({message:"Processando sua requisição",messageColor:"white",spinnerSize:250,spinnerColor:"white"}),p["a"].apaga(e.usuario.usuario).then((function(o){e.$q.loading.hide(),console.log("usuario removido com sucesso"),e.$q.notify({type:"negative",message:"Usuário removido com sucesso.",timeout:5e3}),e.$root.$emit("removeRegistro",e.usuario.usuario),e.reset()}))})).catch((function(){})):x["a"].semPermissao()},setOptionsGrupoUsuario:function(e){if(e.length>0){var o=[];e.map((function(e){return o.push({label:e.descricao,value:e.grupoUsuario})})),this.optionsGrupoUsuario=o}else this.optionsGrupoUsuario=[{label:"Não existe grupo de usuário cadastrado",value:""}]},confereAlterarExcluir:function(){this.possoAlterarUsuario=j["a"].alterar("usuario"),this.possoExcluirUsuario=j["a"].excluir("usuario")}},props:{id:{}},watch:{id:function(e){e&&this.carrega(e)}},computed:k(k({},Object(l["b"])({getPermissoes:"login/getPermissoes",getUsuario:"login/getUsuario"})),{},{possoGravarUsuario:function(){return j["a"].gravar("usuario")}}),mounted:function(){var e=this;p["a"].getOptions().then((function(o){return e.setOptionsGrupoUsuario(o.data.grupoUsuarios)}))}},N=D,_=Object($["a"])(N,a,s,!1,null,null,null);o["default"]=_.exports}}]);