(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[19],{c6f7:function(o,e,t){"use strict";t.r(e);var a=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("q-layout",[t("q-header",{staticClass:"desktop-only"},[t("q-toolbar",{staticClass:"desktop-only"},[t("q-toolbar-title",{staticClass:"text-center"},[t("img",{attrs:{src:o.imageSrc,alt:""}}),t("span",{attrs:{slot:"subtitle"},slot:"subtitle"},[t("div",{staticClass:"q-headline"},[o._v("\n              SISPROT - SISTEMA DE PROTOCOLO DA 1ª REGIÃO MILITAR\n            ")])])])],1)],1),t("q-page-container",[t("q-page",[t("div",{staticClass:"absolute-center",staticStyle:{width:"500px","max-width":"90vw"}},[t("h2",{staticClass:"desktop-only text-center"},[o._v("Bem Vindo")]),t("form",{on:{submit:function(e){return e.preventDefault(),o.submit(e)}}},[t("q-field",{attrs:{label:"Login",orientation:"vertical"}},[t("q-input",{attrs:{autocomplete:"username"},on:{input:function(e){return o.$v.form.login.$touch()}},model:{value:o.form.login,callback:function(e){o.$set(o.form,"login",e)},expression:"form.login"}})],1),t("br"),t("q-field",{attrs:{label:"Senha",orientation:"vertical"}},[t("q-input",{attrs:{type:"password",autocomplete:"current-password"},on:{input:function(e){return o.$v.form.password.$touch()}},model:{value:o.form.password,callback:function(e){o.$set(o.form,"password",e)},expression:"form.password"}})],1),t("br"),t("div",{staticClass:"row justify-center botoes"},[t("q-btn-group",[t("q-btn",{attrs:{type:"submit",color:"primary",glossy:"",label:"Entrar"}})],1)],1)],1)]),t("q-dialog",{ref:"modalRecuperar",attrs:{minimized:""},on:{hide:o.resetaStepper},model:{value:o.modalRecuperar,callback:function(e){o.modalRecuperar=e},expression:"modalRecuperar"}},[t("q-stepper",{ref:"stepper"},[t("q-step",{attrs:{default:"",title:"Identificação"}},[t("h6",[o._v("Esqueceu a password?")]),t("p",[o._v("Confirme seu usuário para receber um email"),t("br"),o._v("\n            com seu código de confirmação.")]),t("form",{on:{submit:function(e){return e.preventDefault(),o.enviarCodigoEmail(e)}}},[t("q-input",{staticClass:"input",attrs:{type:"text","stack-label":"Confirme seu usuário"},on:{input:function(e){return o.$v.recuperarLogin.login.$touch()}},model:{value:o.recuperarLogin.login,callback:function(e){o.$set(o.recuperarLogin,"login",e)},expression:"recuperarLogin.login"}}),t("q-stepper-navigation",{staticClass:"pull-right"},[t("q-btn",{attrs:{color:"primary",type:"submit"}},[o._v("Enviar")])],1)],1)]),t("q-step",{attrs:{title:"Confirmação"}},[t("h6",[o._v("Abra seu email.")]),t("p",[o._v("Enviamos um código para o seu email, "),t("br"),o._v("\n            confirme abaixo para resetar sua password")]),t("form",{on:{submit:function(e){return e.preventDefault(),o.confirmarCodigo(e)}}},[t("q-input",{staticClass:"input",attrs:{type:"text","stack-label":"Insira o código de confirmação"},on:{input:function(e){return o.$v.confirmarToken.token.$touch()}},model:{value:o.confirmarToken.token,callback:function(e){o.$set(o.confirmarToken,"token",e)},expression:"confirmarToken.token"}}),t("q-stepper-navigation",{staticClass:"pull-right"},[t("q-btn",{attrs:{color:"primary",type:"submit"}},[o._v("Enviar")])],1)],1)]),t("q-step",{attrs:{title:"Pronto"}},[t("h6",[o._v("Confirmado!")]),t("p",[o._v("Agora, vamos cadastrar sua nova password.")]),o._v("\n            Digite e confirme a nova password\n            "),t("form",{attrs:{id:"formAlterarSenhaOutroCliente"},on:{submit:function(e){return e.preventDefault(),o.alterarSenhaUsuario(e)}}},[t("q-field",{staticClass:"input",attrs:{helper:"Obrigatório",error:o.$v.alterarSenha.passwordNova.$error,"error-label":"Digite a nova password",label:"Nova password"}},[t("q-input",{attrs:{type:"password",required:"",autocomplete:"new-password"},on:{blur:function(e){return o.$v.alterarSenha.passwordNova.$touch()}},model:{value:o.alterarSenha.passwordNova,callback:function(e){o.$set(o.alterarSenha,"passwordNova",e)},expression:"alterarSenha.passwordNova"}})],1),t("q-field",{staticClass:"input",attrs:{helper:"Obrigatório",error:o.$v.alterarSenha.confirmaSenha.$error,"error-label":"As passwords novas devem ser iguais",label:"Repita a nova password"}},[t("q-input",{attrs:{type:"password",required:"",autocomplete:"new-password"},on:{blur:function(e){return o.$v.alterarSenha.confirmaSenha.$touch()}},model:{value:o.alterarSenha.confirmaSenha,callback:function(e){o.$set(o.alterarSenha,"confirmaSenha",e)},expression:"alterarSenha.confirmaSenha"}})],1),t("q-stepper-navigation",{staticClass:"pull-right"},[t("q-btn",{attrs:{color:"primary",type:"submit"}},[o._v("Enviar")])],1)],1)])],1),t("q-inner-loading",{attrs:{visible:o.loadingVisible}},[t("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1)],1),t("q-dialog",{scopedSlots:o._u([{key:"buttons",fn:function(o){return[t("q-btn",{attrs:{flat:"",label:"Ok"},on:{click:o.cancel}})]}}]),model:{value:o.dialogValida,callback:function(e){o.dialogValida=e},expression:"dialogValida"}},[t("span",{attrs:{slot:"title"},slot:"title"},[o._v("Atenção")]),t("span",{attrs:{slot:"message"},slot:"message"},[o._v("Todos os campos são obrigatórios, e password mínima de 5 caracteres.")])]),t("q-dialog",{scopedSlots:o._u([{key:"buttons",fn:function(o){return[t("q-btn",{attrs:{flat:"",label:"Ok"},on:{click:o.cancel}})]}}]),model:{value:o.dialogLoginObrigatorio,callback:function(e){o.dialogLoginObrigatorio=e},expression:"dialogLoginObrigatorio"}},[t("span",{attrs:{slot:"title"},slot:"title"},[o._v("Atenção")]),t("span",{attrs:{slot:"message"},slot:"message"},[o._v("Campo Login é obrigatório")])]),t("q-dialog",{scopedSlots:o._u([{key:"buttons",fn:function(o){return[t("q-btn",{attrs:{flat:"",label:"Ok"},on:{click:o.cancel}})]}}]),model:{value:o.dialogConfirmarToken,callback:function(e){o.dialogConfirmarToken=e},expression:"dialogConfirmarToken"}},[t("span",{attrs:{slot:"title"},slot:"title"},[o._v("Atenção")]),t("span",{attrs:{slot:"message"},slot:"message"},[o._v("Insira o código recebido")])]),t("q-dialog",{scopedSlots:o._u([{key:"buttons",fn:function(o){return[t("q-btn",{attrs:{flat:"",label:"Ok"},on:{click:o.cancel}})]}}]),model:{value:o.dialogConfirmarSenha,callback:function(e){o.dialogConfirmarSenha=e},expression:"dialogConfirmarSenha"}},[t("span",{attrs:{slot:"title"},slot:"title"},[o._v("Atenção")]),t("span",{attrs:{slot:"message"},slot:"message"},[o._v("As passwords não podem ser vazias e devem ser iguais")])])],1)],1),t("q-footer",{staticClass:"desktop-only"},[t("q-toolbar",[t("q-toolbar-title",{staticClass:"text-center"},[o._v("\n        Copyright © 2019 - Exército Brasileiro - 1ª RM. - Desenvolvido por ST Moreira\n      ")])],1)],1)],1)},r=[],n=(t("6b54"),t("06db"),t("2397"),t("970b")),i=t.n(n),s=t("5bc3"),l=t.n(s),c=t("ed6d"),u=t.n(c),d=t("6b58"),p=t.n(d),m=t("36c6"),g=t.n(m),f=t("5c12");function h(o){var e=v();return function(){var t,a=g()(o);if(e){var r=g()(this).constructor;t=Reflect.construct(a,arguments,r)}else t=a.apply(this,arguments);return p()(this,t)}}function v(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(o){return!1}}var b=function(o){u()(t,o);var e=h(t);function t(){return i()(this,t),e.apply(this,arguments)}return l()(t,null,[{key:"enviarCodigoEmail",value:function(o){return this.post("recuperar/login",o)}},{key:"confirmarToken",value:function(o){return this.post("recuperar/token",o)}},{key:"confirmarTokenLogin",value:function(o){return this.post("clientes/twa/confirmar",o)}},{key:"confirmarTokenTwa",value:function(o){return this.post("clientes/twa/token",o)}},{key:"alterarSenha",value:function(o){return this.put("recuperar/alterarsenha",o)}}]),t}(f["a"]),k=b,q=t("5785"),$=t("b5ae"),S={name:"Login",data:function(){return{imageSrc:"statics/logo.png",confirmarToken:{token:""},usuario:"",form:{login:"",password:""},recuperarLogin:{login:""},disableBotaoNext:!0,alterarSenha:{usuario:"",passwordNova:"",confirmaSenha:""},loadingVisible:!1,loadingConfirmarToken:!1,modalRecuperar:!1,dialogValida:!1,dialogLoginObrigatorio:!1,dialogConfirmarToken:!1,dialogConfirmarSenha:!1}},validations:{form:{login:{required:$["required"]},password:{required:$["required"],minLength:Object($["minLength"])(5)}},recuperarLogin:{login:{required:$["required"]}},confirmarToken:{token:{required:$["required"]}},alterarSenha:{passwordNova:{required:$["required"],minLength:Object($["minLength"])(5)},confirmaSenha:{sameAsPassword:Object($["sameAs"])("passwordNova")}}},props:{nome:{},grupo:{}},computed:{},methods:{resetaStepper:function(){this.recuperarLogin.login="",this.alterarSenha.usuario="",this.alterarSenha.passwordNova="",this.alterarSenha.confirmaSenha="",this.confirmarToken.token="",this.$refs.stepper.reset()},submit:function(){var o=this;this.dialogValida?this.dialogValida=!1:(this.$v.form.$touch(),this.$v.form.$error?this.dialogValida=!0:(this.$q.loading.show({message:"Validando seus dados",messageColor:"white",spinnerSize:250,spinnerColor:"white"}),q["a"].logar(this.form).then((function(e){o.$q.loading.hide(),console.log(e.data),200===e.status?(o.$store.commit("login/setToken",e.data.token),o.$store.commit("login/setLogin",{login:o.form.login,id:e.data.id,categoriaUsuario:e.data.categoriaUsuario}),o.$store.commit("login/setSessaoInvalida",!1),o.$store.commit("login/setAuth",e.data.token),o.$store.commit("login/setPermissoes",e.data.permissoes),e.data.primeiroLogin?o.$router.push("/dashboard/primeiroacesso"):o.$router.push("/dashboard")):(console.log("acesso negado"),o.$q.dialog({title:"Atenção",message:e.data.error}).then((function(){})).catch((function(){})))}))))},enviarCodigoEmail:function(){var o=this;this.dialogLoginObrigatorio?this.dialogLoginObrigatorio=!1:(this.$v.recuperarLogin.$touch(),this.$v.recuperarLogin.$error?this.dialogLoginObrigatorio=!0:(this.loadingVisible=!0,k.enviarCodigoEmail({login:this.recuperarLogin.login}).then((function(e){o.loadingVisible=!1,1===e.data?(console.log("Email enviado ao usuario."),o.$refs.stepper.next()):(o.recuperarLogin.login="",o.$q.dialog({title:"Atenção",message:"Login não encontrado."}).then((function(){})).catch((function(){})))}))))},confirmarCodigo:function(){var o=this;this.dialogConfirmarToken?this.dialogConfirmarToken=!1:(this.$v.confirmarToken.$touch(),this.$v.confirmarToken.$error?this.dialogConfirmarToken=!0:(this.loadingVisible=!0,k.confirmarToken({login:this.recuperarLogin.login,token:this.confirmarToken.token}).then((function(e){o.loadingVisible=!1,1===e.data.result?(console.log("Token confirmado."),o.alterarSenha.usuario=e.data.usuario,o.$refs.stepper.next()):(o.confirmarToken.token="",o.$q.dialog({title:"Atenção",message:"Código digitado está incorreto."}).then((function(){})).catch((function(){})))}))))},confirmarTokenLogin:function(){var o=this;this.$v.confirmarToken.$touch(),this.$v.confirmarToken.$error?this.$q.dialog({title:"Atenção",message:"O Código deve ser preenchido."}).then((function(){})).catch((function(){})):(this.loadingConfirmarToken=!0,k.confirmarTokenLogin({usuario:this.usuario,token:this.confirmarToken.token}).then((function(e){o.loadingConfirmarToken=!1,1===e.data.result?(console.log("Token confirmado."),o.$store.dispatch("setLinks",[]),o.$router.push("/home/mineradoras")):(o.confirmarToken.token="",o.$q.dialog({title:"Atenção",message:"Código está incorreto."}).then((function(){})).catch((function(){})))})))},alterarSenhaUsuario:function(){var o=this;this.dialogConfirmarSenha?this.dialogConfirmarSenha=!1:(this.$v.alterarSenha.$touch(),this.$v.alterarSenha.$error?this.dialogConfirmarSenha=!0:(this.loadingVisible=!0,k.alterarSenha({usuario:this.alterarSenha.usuario,password:this.alterarSenha.passwordNova,token:this.confirmarToken.token}).then((function(e){o.loadingVisible=!1,o.$q.dialog({title:"Perfeito!",message:"Sua password foi alterada com sucesso, já pode efetuar o login."}).then((function(){o.modalRecuperar=!1})).catch((function(){o.modalRecuperar=!1}))}))))}},mounted:function(){var o=this;this.getSessaoInvalida&&this.$q.dialog({title:"Atenção",message:"Sua sessão ficou muito tempo inativa, é necessário logar novamente."}).then((function(){o.modalRecuperar=!1})).catch((function(){o.modalRecuperar=!1}))}},w=S,C=t("2877"),T=Object(C["a"])(w,a,r,!1,null,null,null);e["default"]=T.exports}}]);